{% set version = "research" %}
{% set pageTitle = "Test strip QR code reference" %}

{% extends "includes/layout-LFD.html" %}

{% block beforeContent %}
  <div class="govuk-phase-banner">
    <p class="govuk-phase-banner__content">
      <strong class="govuk-tag govuk-phase-banner__content__tag">
        beta
      </strong>
      <span class="govuk-phase-banner__text">
        This is a new service – your <a class="govuk-link" href="#">feedback</a> will help us to improve it.
      </span>
    </p>
  </div>

  <a class="govuk-back-link" href="#">Back</a>
{% endblock %}

{% block content %}
  {% include "includes/gtm-noscript.html" %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      <form action="/IBT/lfd-self-report/e2e-prototypes/{{version}}/name" method="post">

        <div class="govuk-form-group">
          <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
              <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">
                {{ pageTitle }}
              </h1>
            </legend>

            <p class="govuk-body">
              The reference is printed on the test strip under the QR code.
            </p>
            <p class="govuk-body">
              The test strip QR code should look like this:
            </p>

            <img src="/public/images/lfd-test-strip.svg" type="image" class="responsive-image-center" alt="Illustration of a test strip showing the reference  printed on the test strip under the QR code"/>

          </fieldset>
        </div>

        <a id="scan-button" class="govuk-button" data-toggle="modal" data-target="modal-with-data-attributes" href="/IBT/lfd-self-report/e2e-prototypes/{{version}}/barcode-scan-android">Scan QR code</a>
        <button id="manual-entry" class="govuk-button govuk-button--secondary" data-module="govuk-button">Enter test strip QR code manually</button>

        <div class="gem-c-modal-dialogue" data-module="modal-dialogue" id="modal-window-2" style="display: block;">
          <div class="gem-c-modal-dialogue__overlay"></div>
          <dialog class="gem-c-modal-dialogue__box" aria-modal="true" role="dialog" tabindex="0">
            <div class="gem-c-modal-dialogue__header">
              <svg role="presentation" focusable="false" class="gem-c-modal-dialogue__logotype-crown" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 132 97" height="26" width="30">
                <path fill="currentColor" fill-rule="evenodd" d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"></path>
                <image src="/assets/govuk-logotype-crown-0cdbde943be3a6518a5d7c00b607d134f4d5e3d0e8c68a1bfa2dc81f1f3edc4e.png" class="gem-c-modal-dialogue__logotype-crown-fallback-image"></image>
              </svg>
            </div>
            <div class="gem-c-modal-dialogue__content-scanner" id="scanner-wrapper">
              <p class="govuk-body">
                <strong>Scanning will start automatically when the QR code is within the frame</strong>
              </p>

              <script src="https://cdn.jsdelivr.net/npm/scandit-sdk@5.x"></script>

              <scandit-barcode-picker
                id="barcodePicker"
                configure.licenseKey="AbZxHhS+NbmiADJfUiuZ2iUaZRoeKa4GCTLu4KFFgGyKH2vUkn0JpCJoyBABajTEH3YqOMsYTH7iWoi+1XBqvjJpT6vbWLs/jEXEg3dhgNQ3UA9ZD0J+8QtrqDinWyRI3XECxE5s9JU1NV9evxgBz9xhH8I9WGbev1mCapBsKk2yYVH33yTlG1tcETWkDzDtbW9mYwh5MyxhcntcwHOFsHwh0zaSHf9bohhSkkQZ5D4xKHAnRhHf5Z7WkHMmCGg5pDu6xTg60YCEZy74vbVdjgg1sBfrxX3mvW/AGytCkn5v4JZ3I1mKqtqCNQxuJTNiecouIIcYdU2Vz3DocNpXGozfmtM/5K6TvrsEeeWYjkA/U8V3CzafMn1xVVdQEvEY0i0elNOtD3TnmrgbF1qv7582IV9kU8JQetxUkj79YLVEJAmAPaxrG4dazuTha6o2El8ElvhvM8U1yN2aXn2LtCfGXZabA0zYCDesH7PzxOlLLYPOr6JIaKPfBK3Gw9VqxrhAYZlPsJoKjEyZkbbisUOY29YFT1AwxrWa49qzETKkUPu0iL2WwzQ4NJnoZs9GFZAeP8V079cKfyI+Q0jPzQglzKmNe7jMepYWDr7jn/sTGb/j+dM/BwSODQQRWiHENrQ2N517Pgob2cP8q33GrBg92OTPcSpI7LB9lI0ZDrfqFX5+cnaFBUn01OU0mYEoU7TPGyHrplUJA0pSUTa+8WvljEpYoNd9qqMtGjc7xP+60/UNix51ZbFFv/tp1vXpUC2IUpWZQHSvgbI6CK6hSBZMwLhWluYIOHM/NicvzIoJlFlMaIVQ/u8HYhM9ZxlNGMf7DyvFswMeiKcqJlrhFISYpi9AHl/Tys6LZ0OKJUCTraR6altiFXc16q/DwGF3uJ6bjbb/uoGGIz/47JVaW+xEVYaXkA=="
                configure.engineLocation="https://cdn.jsdelivr.net/npm/scandit-sdk@5.x/build/"
                playSoundOnScan="true"
                scanSettings.searchArea='{"x":0.1,"y":0.2,"width":0.8,"height":0.6}'
                guiStyle="viewfinder"
                enableTorchToggle="true"
                videoFit="contain"
                scanSettings.enabledSymbologies='["data-matrix", "code128", "qr"]'
                >
              </scandit-barcode-picker>

            </div>
            <button id="close-button-2" class="gem-c-modal-dialogue__close-button" aria-label="Close modal dialogue">×</button>

          </dialog>
        </div>

        <input style="display: none; visibility: hidden;" class="govuk-input govuk-!-width-two-thirds" id="test-strip-id" name="test-strip-id" type="text" >
        <input style="display: none; visibility: hidden;" class="govuk-input govuk-!-width-two-thirds" id="test-strip-id-confirm" name="test-strip-id-confirm" type="text" >

      </form>

    </div>
  </div>

  <script type="text/javascript">
    submitEvent()

    document.body.parentNode.style.overflow = "hidden"

    if(localStorage.getItem("testStripIdData")) {
      document.getElementById('test-strip-id').value = localStorage.getItem("testStripIdData");
      document.getElementById('test-strip-id-confirm').value = localStorage.getItem("testStripIdData");
    }

    const modalPermissionsDenied = `
          <div class="gem-c-modal-dialogue__overlay"></div>
          <dialog class="gem-c-modal-dialogue__box" aria-modal="true" role="dialog" tabindex="0">
            <div class="gem-c-modal-dialogue__header">
              <svg role="presentation" focusable="false" class="gem-c-modal-dialogue__logotype-crown" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 132 97" height="26" width="30">
                <path fill="currentColor" fill-rule="evenodd" d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"></path>
                <image src="/assets/govuk-logotype-crown-0cdbde943be3a6518a5d7c00b607d134f4d5e3d0e8c68a1bfa2dc81f1f3edc4e.png" class="gem-c-modal-dialogue__logotype-crown-fallback-image"></image>
              </svg>
            </div>
            <div class="gem-c-modal-dialogue__content">
              <p class="govuk-body"><strong>Camera access needs to be enabled</strong></p>
              <p class="govuk-body" style="display: flex; align-items: center;">
                <svg width="40px" height="38px" viewBox="0 0 471 472" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <title>camera-not-enabled@2x</title>
                  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <g id="camera-not-enabled" fill="#000000" fill-rule="nonzero">
                      <path d="M467.0831,3.3945 C465.0519,1.2304 462.212,-5.68434189e-14 459.2433,-5.68434189e-14 C456.2746,-5.68434189e-14 453.4347,1.2305 451.4035,3.3945 L142.9535,311.8445 L30.2735,425.6345 L3.3945,452.5135 L3.3945,452.517406 C1.2304,454.548606 0,457.384606 0,460.357206 C0,463.326006 1.2305,466.161906 3.3945,468.197006 C5.4257,470.361106 8.2656,471.591506 11.2343,471.591506 C14.203,471.591506 17.0429,470.361006 19.0741,468.197006 L297.9541,189.317006 L385.3091,100.840006 L467.0711,19.078006 C469.2352,17.046806 470.4656,14.206906 470.4656,11.238206 C470.4656,8.269506 469.2351,5.429606 467.0711,3.398406 L467.0831,3.3945 Z" id="Path"></path>
                      <path d="M139.1431,299.5245 C135.9673,289.6065 134.3814,279.2475 134.44,268.8365 C134.498593,242.1175 145.139,216.5165 164.03,197.6255 C182.921,178.7345 208.526,168.0945 235.241,168.0355 C245.655,167.976907 256.011,169.5628 265.929,172.7386 L347.019,91.6486 L318.347,48.6406 C312.3197,39.4961 302.191,33.8866 291.242,33.6323564 L179.242,33.6323564 C167.972,33.589631 157.445,39.2342 151.242,48.6406 L117.195,100.8356 L56.043,100.8356 C47.1328,100.8356 38.586,104.3747 32.285,110.6754 C25.9803,116.9762 22.4406171,125.5234 22.4406171,134.4334 L22.4406171,403.2334 C22.417762,406.9873 23.10136,410.71 24.4568,414.2104 L139.1431,299.5245 Z" id="Path"></path>
                      <path d="M414.4431,100.8345 L401.4511,100.8345 L305.5801,196.7055 C325.5921,215.3505 337.1661,241.3265 337.6461,268.6745 C338.13048,296.0185 327.4781,322.3895 308.1381,341.7295 C288.7981,361.0695 262.4311,371.7175 235.0831,371.2375 C207.7351,370.75312 181.7591,359.1785 163.1141,339.1715 L65.4501,436.8355 L414.4401,436.8355 C423.3503,436.8355 431.8971,433.2925 438.1981,426.9917 C444.5028,420.6909 448.0419,412.1437 448.0419,403.2337 L448.0419,134.4337 C448.0419,125.5235 444.5028,116.9767 438.1981,110.6757 C431.8973,104.3749 423.3501,100.8345 414.4401,100.8345 L414.4431,100.8345 Z" id="Path"></path>
                    </g>
                  </g>
                </svg>
                <span class="govuk-!-padding-left-3">Camera not available</span>
              </p>
              <p class="govuk-body">You will need to allow camera permissions to use the scanner.</p>
              <p class="govuk-body">You may need to change the settings on your device.</p>
              <p class="body"><a href="#" target="blank">iOS(Apple): how to allow camera access (opens in new tab)</a></p>
              <p class="body"><a href="https://support.google.com/android/answer/9431959?hl=en-GB" target="blank">Android: how to allow camera access (opens in new tab)</a></p>
            </div>
            <a class="gem-c-modal-dialogue__close-button" aria-label="Close modal dialogue" href="/IBT/lfd-self-report/e2e-prototypes/{{version}}/barcode">×</a>
          </dialog>
    `

    const modalIncorrectCode = `
        <div class="gem-c-modal-dialogue__overlay"></div>
        <dialog class="gem-c-modal-dialogue__box" aria-modal="true" role="dialog" tabindex="0">
          <div class="gem-c-modal-dialogue__header">
            <svg role="presentation" focusable="false" class="gem-c-modal-dialogue__logotype-crown" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 132 97" height="26" width="30">
              <path fill="currentColor" fill-rule="evenodd" d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"></path>
              <image src="/assets/govuk-logotype-crown-0cdbde943be3a6518a5d7c00b607d134f4d5e3d0e8c68a1bfa2dc81f1f3edc4e.png" class="gem-c-modal-dialogue__logotype-crown-fallback-image"></image>
            </svg>
          </div>
          <div class="gem-c-modal-dialogue__content">
            <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
              <h2 class="govuk-error-summary__title" id="error-summary-title">
                There is a problem
              </h2>
              <div class="govuk-error-summary__body">
                <ul class="govuk-list govuk-error-summary__list">
                  <li>
                    <a href="#">That is not a correct QR code.
                      Please try again</a>
                  </li>
                </ul>
              </div>
            </div>
            <a id="scan-button" class="govuk-button" data-module="govuk-button" href="/IBT/lfd-self-report/e2e-prototypes/{{version}}/barcode-scan-android">Scan again</a>
          </div>
          <a class="gem-c-modal-dialogue__close-button" aria-label="Close modal dialogue" href="/IBT/lfd-self-report/e2e-prototypes/{{version}}/barcode">×</a>
        </dialog>
    `

    const modalScannedBarcode = `
    <div class="gem-c-modal-dialogue__overlay"></div>
          <dialog class="gem-c-modal-dialogue__box" aria-modal="true" role="dialog" tabindex="0">
            <div class="gem-c-modal-dialogue__header">
              <svg role="presentation" focusable="false" class="gem-c-modal-dialogue__logotype-crown" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 132 97" height="26" width="30">
                <path fill="currentColor" fill-rule="evenodd" d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"></path>
                <image src="/assets/govuk-logotype-crown-0cdbde943be3a6518a5d7c00b607d134f4d5e3d0e8c68a1bfa2dc81f1f3edc4e.png" class="gem-c-modal-dialogue__logotype-crown-fallback-image"></image>
              </svg>
            </div>
            <div class="gem-c-modal-dialogue__content">
              <p class="govuk-body">
                Thanks for scanning your QR code.<br>
                This is what we have captured:
              </p>
              <p class="govuk-body">Test strip QR code: <strong id="scanned-barcode"></strong></p>
              <button id="scan-button" class="govuk-button" data-module="govuk-button" href="/IBT/lfd-self-report/e2e-prototypes/{{version}}/name">Continue</button>
              <p class="body"><a href="/IBT/lfd-self-report/e2e-prototypes/{{version}}/barcode-scan-android">Scan again</a></p>
            </div>
            <a class="gem-c-modal-dialogue__close-button" aria-label="Close modal dialogue" href="/IBT/lfd-self-report/e2e-prototypes/{{version}}/barcode-manual">×</a>
          </dialog>
    `

    navigator.permissions.query( { name: 'camera' } ).then(function(permissionStatus){
      permissionStatus.onchange = function(){
        if(permissionStatus.state == "denied") {
          document.getElementById('modal-window-2').innerHTML = modalPermissionsDenied
        }
      }
    })

    function addListener(button, buttonClicked) {
      button.addEventListener('click', function (event) {
        event.preventDefault()
        if (button.getAttribute('disabled') === 'disabled') {
        } else {
          event.preventDefault()
          buttonClicked(button)
        }
      })
    }

    function closeButtonClicked(target) {
        window.location.href = '/IBT/lfd-self-report/e2e-prototypes/{{version}}/barcode';
    }

    function manualEntryButtonClicked(target) {
      setTimeout(function () {
        document.getElementById('content-1').style.display = 'none'
        document.getElementById('content-2').style.display = 'block'
      }, 100)
    }

    function submitEvent() {
      var manualEntryButton = document.getElementById('manual-entry')
      var closeButton2 = document.getElementById('close-button-2')

      addListener(manualEntryButton, manualEntryButtonClicked)
      addListener(closeButton2, closeButtonClicked)
    }

    const barcodePicker = document.getElementById('barcodePicker')
    barcodePicker.addEventListener('scan', function (event) {
      event.preventDefault()
      setTimeout(function () {
        const barcodeReference = event.detail.barcodes[0].data;
        const checkLettersEnd = barcodeReference.slice(11,13)

        if(event.detail.barcodes[0].symbology == "qr" && checkLettersEnd !== "GB" && barcodeReference.length > 10) {

          if(!localStorage.getItem("testStripIdData")) {
            localStorage.setItem("testStripIdData", barcodeReference);
          }

          document.getElementById('modal-window-2').innerHTML = modalScannedBarcode;
          document.getElementById('scanned-barcode').innerHTML = localStorage.getItem("testStripIdData");
        } else {
          document.getElementById('modal-window-2').innerHTML = modalIncorrectCode;
        }
      }, 300)
    })

  </script>

{% endblock %}
